# CoroutineEx

# ì½”ë£¨í‹´

Created: 2022ë…„ 3ì›” 14ì¼ ì˜¤í›„ 3:36

# Kotlinê³¼ ì½”ë£¨í‹´

ì½”ë£¨í‹´ì˜ ì£¼ìš” ê¸°ëŠ¥ ì¤‘ í•˜ë‚˜ëŠ” ìƒíƒœë¥¼ ì €ìž¥í•˜ì—¬ ì¤‘ë‹¨í–ˆë‹¤ê°€ ìž¬ê°œí•  ìˆ˜ ìžˆìœ¼ë©°, ì½”ë£¨í‹´ì€ ì‹¤í–‰ë˜ê±°ë‚˜ ì‹¤í–‰ë˜ì§€ ì•Šì„ ìˆ˜ ìžˆë‹¤. â†’ ë©€í‹° ìŠ¤ë ˆë“œ ì‚¬ìš©ì— ë§¤ìš° ìœ ìš©

| Job | ì·¨ì†Œ ê°€ëŠ¥í•œ ìž‘ì—… ë‹¨ìœ„(ì˜ˆ:Â launch() í•¨ìˆ˜ë¡œ ë§Œë“  ìž‘ì—… ë‹¨ìœ„)ìž…ë‹ˆë‹¤. |
| --- | --- |
| Dispatcher | ì½”ë£¨í‹´ì´ ì‚¬ìš©í•  ìŠ¤ë ˆë“œë¥¼ ê²°ì •í•©ë‹ˆë‹¤.Â Mainë””ìŠ¤íŒ¨ì²˜ëŠ” í•­ìƒ ê¸°ë³¸ ìŠ¤ë ˆë“œì—ì„œ     ì½”ë£¨í‹´ì„ ì‹¤í–‰í•˜ì§€ë§ŒÂ Defaultë‚˜Â IO,Â Unconfinedì™€ ê°™ì€ ë””ìŠ¤íŒ¨ì²˜ëŠ” ë‹¤ë¥¸ ìŠ¤ë ˆë“œë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. * ì½”ë£¨í‹´ ìŠ¤ì½”í”„ë§Œ |
| CoroutineScope | launch()Â ë°Â async()ì™€ ê°™ì€ ìƒˆ ì½”ë£¨í‹´ì„ ë§Œë“œëŠ” ë° ì‚¬ìš©ë˜ëŠ” í•¨ìˆ˜ëŠ”Â CoroutineScopeë¥¼ í™•ìž¥í•©ë‹ˆë‹¤.  *í•„ìš”í• ë•Œë§Œ ì—´ê³  ì™„ë£Œë˜ë©´ ë‹«ì•„ì¤Œ ( ë„¤íŠ¸ì›Œí¬ ë“± ) |
| GlobalScope | GlobalScopeëŠ” ì•±ì´ ì‹¤í–‰ë˜ëŠ” í•œ ë‚´ë¶€ì˜ ì½”ë£¨í‹´ì´ ì‹¤í–‰ë˜ë„ë¡ í—ˆìš©í•©ë‹ˆë‹¤.             *ì•±ì˜ ìƒëª…ì£¼ê¸°ì™€ í•¨ê»˜ ë™ìž‘ |

# ì½”ë£¨í‹´ì˜ ìƒíƒœê´€ë¦¬

> **cancel**
> 

ì½”ë£¨í‹´ì˜ ë™ìž‘ì„ ë©ˆì¶”ëŠ” ìƒíƒœê´€ë¦¬ ë§¤ì„œë“œ. 

í•˜ë‚˜ì˜ ìŠ¤ì½”í”„ ì•ˆì— ì—¬ëŸ¬ ì½”ë£¨í‹´ì´ ì¡´ìž¬í•˜ëŠ” ê²½ìš° í•˜ìœ„ ì½”ë£¨í‹´ê¹Œì§€ ëª¨ë‘ ì¤‘ì§€

ì˜ˆì‹œ ì½”ë“œ)

```kotlin
val job = CoroutineScope(Dispatchers.Default).launch{
	val job1 = launch{
                for (i in 0..5){
                    delay(500)
                    Log.e("Jaemu>>","ì½”ë£¨í‹´ $i")
                }
            }
}

button.setOnClickListener {
            job.cancel()
        }

// ìœ„ ì½”ë“œë¥¼ ì‹¤í–‰ì¤‘ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ jobê³¼ ê·¸ í•˜ìœ„ì˜ job1ë„ ê°™ì´ ì¢…ë£Œ

```

```kotlin
val job = CoroutineScope(Dispatchers.Default).launch{
            launch{
                for (i in 0..5){
                    delay(500) // 1. delayëŠ” yieldì™€ ê°™ì´ ë‹¤ë¥¸ ì½”ë£¨í‹´ì— ì‹¤í–‰ì„ ì–‘ë³´
                    Log.e("Jaemu>>","ì½”ë£¨í‹´ $i")
                }
            }

            launch{
                for (i in 6..10){
                    delay(500)
                    Log.e("Jaemu>>","ì½”ë£¨í‹´ $i")
                }
            }
        }

button.setOnClickListener {
            job.cancel()
        }

// 2. ë”°ë¼ì„œ ìœ„ ì½”ë“œì˜ ê²°ê³¼ëŠ”

E/Jaemu>>: ì½”ë£¨í‹´ 0
E/Jaemu>>: ì½”ë£¨í‹´ 6
E/Jaemu>>: ì½”ë£¨í‹´ 7
E/Jaemu>>: ì½”ë£¨í‹´ 1
E/Jaemu>>: ì½”ë£¨í‹´ 2
E/Jaemu>>: ì½”ë£¨í‹´ 8
E/Jaemu>>: ì½”ë£¨í‹´ 9
E/Jaemu>>: ì½”ë£¨í‹´ 3
E/Jaemu>>: ì½”ë£¨í‹´ 10
E/Jaemu>>: ì½”ë£¨í‹´ 4
E/Jaemu>>: ì½”ë£¨í‹´ 5

//3 . ì„œë¡œ ì–‘ë³´ë§Œ í•˜ë©° ì‹¤í–‰ì‹œê°„ì´ ë‹¤ë¥´ë‹ˆ ìˆœì„œë„ ë’¤ì£½ë°•ì£½ :(
```

> join
> 

ì½”ë£¨í‹´ ë‚´ë¶€ì— ì—¬ëŸ¬ `launch`ë¸”ë¡ì´ ìžˆëŠ” ê²½ìš° ì‹¤í–‰ ìˆœì„œë¥¼ ì •í•  ìˆ˜ ì—†ìŒ.

ìˆœì„œë¥¼ ì •í•´ì•¼ í•œë‹¤ë©´ `join()`ì„ ì‚¬ìš©í•´ ìˆœì°¨ì ìœ¼ë¡œ ì‹¤í–‰.

ì˜ˆì‹œ ì½”ë“œ)

```kotlin
val job = CoroutineScope(Dispatchers.Default).launch{
            launch{
                for (i in 0..5){
                    delay(500) 
                    Log.e("Jaemu>>","ì½”ë£¨í‹´ $i")
                }
            }.join() // 1. join ì„ ì–¸ì‹œ í•´ë‹¹ launchë¸”ë¡ì´ ë¨¼ì € ì‹¤í–‰

            launch{
                for (i in 6..10){
                    delay(500)
                    Log.e("Jaemu>>","ì½”ë£¨í‹´ $i")
                }
            }
        }

button.setOnClickListener {
            job.cancel()
        }

// 2. ë”°ë¼ì„œ ìœ„ ì½”ë“œì˜ ê²°ê³¼ëŠ”

E/Jaemu>>: ì½”ë£¨í‹´ 0
E/Jaemu>>: ì½”ë£¨í‹´ 1
E/Jaemu>>: ì½”ë£¨í‹´ 2
E/Jaemu>>: ì½”ë£¨í‹´ 3
E/Jaemu>>: ì½”ë£¨í‹´ 4
E/Jaemu>>: ì½”ë£¨í‹´ 5
E/Jaemu>>: ì½”ë£¨í‹´ 6
E/Jaemu>>: ì½”ë£¨í‹´ 7
E/Jaemu>>: ì½”ë£¨í‹´ 8
E/Jaemu>>: ì½”ë£¨í‹´ 9
E/Jaemu>>: ì½”ë£¨í‹´ 10

//3 . ìˆœì°¨ì ìœ¼ë¡œ ì‹¤í–‰ë˜ëŠ” ëª¨ìŠµ
```

> async
> 

ì½”ë£¨í‹´ ìŠ¤ì½”í”„ì˜ ê²°ê³¼ë¥¼ ë°›ì•„ì™€ ì‚¬ìš©í•  ìˆ˜ ìžˆëŠ”ë°, ì´ë¥¼ `async()`ë¡œ í•  ìˆ˜ ìžˆë‹¤.

ë„¤íŠ¸ì›Œí¬ ìž‘ì—…ê³¼ ê°™ì´ ì‹œê°„ì´ ë‹¤ì†Œ ì†Œìš”ë˜ëŠ” ìž‘ì—…ì„ `async()` ë¡œ ì²˜ë¦¬í•˜ê³ 

`await()`ë¥¼ ì‚¬ìš©í•´ ê²°ê³¼ë¥¼ ë°›ì•„ì˜´. ì´ë•Œ, `async()` ìž‘ì—…ì´ ëë‚˜ê³  `await()` ê°€ í˜¸ì¶œ.

ì˜ˆì‹œ ì½”ë“œ)

```kotlin
val formatter = DateTimeFormatter.ISO_LOCAL_TIME

val job = CoroutineScope(Dispatchers.Default).async{ 
	val as1 = async{ // 1. asyncë¥¼ ì‚¬ìš©í•´ 500 ë°€ë¦¬ì„¸ì»¨ë“œë¥¼ ê¸°ë‹¤ë¦° í›„ 200 ë°˜í™˜
		Log.e("Jaemu>>", "as1 start : "+formatter.format(LocalDateTime.now()))
		delay(500)
    Log.e("Jaemu>>", "as1 end : "+formatter.format(LocalDateTime.now()))
    200
  }

  val as2 = async{ // 2. asyncë¥¼ ì‚¬ìš©í•´ 1000 ë°€ë¦¬ì„¸ì»¨ë“œë¥¼ ê¸°ë‹¤ë¦° í›„ 300 ë°˜í™˜
    Log.e("Jaemu>>", "as2 start : "+formatter.format(LocalDateTime.now()))
    delay(1000)
    Log.e("Jaemu>>", "as2 end : "+formatter.format(LocalDateTime.now()))
    300
  }
	
	// 3. 1ë²ˆ í…ŒìŠ¤í¬ê°€ ë¨¼ì € ëë‚˜ì§€ë§Œ as2.await()ê°€ ìžˆìœ¼ë¯€ë¡œ 2ë²ˆ í…ŒìŠ¤í¬ê°€ ëë‚ ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¬ê³ 
	// ê²°ê³¼ë¥¼ ì¶œë ¥
  Log.e("Jaemu>>","${as1.await()} + ${as2.await()}")
}       

// ê²°ê³¼
E/Jaemu>>: as2 start : 21:23:32.174
E/Jaemu>>: as1 start : 21:23:32.174
E/Jaemu>>: as1 end : 21:23:32.676
E/Jaemu>>: as2 end : 21:23:33.179
E/Jaemu>>: 200 + 300
```

> suspend
> 

suspend í‚¤ì›Œë“œê°€ ì½”ë£¨í‹´ ì•ˆì—ì„œ ì‚¬ìš©ë˜ë©´ ì´ì „ê¹Œì§€ì˜ ì½”ë“œì˜ ì‹¤í–‰ì´ ë©ˆì¶”ê³  suspend í•¨ìˆ˜ê°€ ì™„ë£Œë˜ê³  ë©ˆì¶°ìžˆë˜ ì½”ë£¨í‹´ ìŠ¤ì½”í”„ì˜ ë‹¤ìŒ ì½”ë“œê°€ ì‹¤í–‰ëœë‹¤.

ì´ê²Œ ê²°êµ­ ì½”ë£¨í‹´ ìŠ¤ì½”í”„ ì•ˆì—ì„œ ìžë™ìœ¼ë¡œ ë°±ê·¸ë¼ìš´ë“œ ìŠ¤ë ˆë“œì²˜ëŸ¼ ë™ìž‘í•œë‹¤ê³  í•œë‹¤.

**ì½”ë£¨í‹´ì„ ì‚¬ìš©í•˜ê¸° ì „ì— Threadë¡œ ì½”ë”©í•´ë³´ì‹  ë¶„ë“¤ì€ ì•Œê²ƒì´ë‹¤... ìžë™ìœ¼ë¡œ ìŠ¤ë ˆë“œë¥¼ ê´€ë¦¬í•´ì¤€ë‹¤ëŠ”ê²Œ ì–¼ë§ˆë‚˜ íŽ¸ë¦¬í•œê²ƒì¸ì§€.. ì—ìš±ðŸ¤¢*

ì˜ˆì‹œ ì½”ë“œ)

```kotlin
suspend fun suspendFunc(){
            for(i in 0..10){
                Log.e("Jaemu>>","$i")
            }
}

CoroutineScope(Dispatchers.Main).launch {
	// suspend í•¨ìˆ˜ê°€ ë¨¼ì € ì‹¤í–‰ ëœ í›„, ë‚˜ë¨¸ì§€ launchë¸”ë¡ë“¤ì´ ì‹¤í–‰ëœë‹¤.
	launch{
		for (i in 11..20){
			delay(500)
      Log.e("Jaemu>>","ì½”ë£¨í‹´ $i")
		}
	}
	
	// suspendí•¨ìˆ˜
  suspendFunc()

  launch{
     for (i in 21..30){
        delay(500)
        Log.e("Jaemu>>","ì½”ë£¨í‹´ $i")
      }
   }
}

// ê²°ê³¼ - ê¸¸ì–´ì„œ ëì— ìžë¦„.
E/Jaemu>>: 0
E/Jaemu>>: 1
E/Jaemu>>: 2
E/Jaemu>>: 3
E/Jaemu>>: 4
E/Jaemu>>: 5
E/Jaemu>>: 6
E/Jaemu>>: 7
E/Jaemu>>: 8
E/Jaemu>>: 9
E/Jaemu>>: 10       // <- suspend í•¨ìˆ˜ê°€ ëë‚˜ì•¼ ë‹¤ë¥¸ launchë¸”ë¡ë“¤ì´ ì‹¤í–‰ë˜ëŠ” ëª¨ìŠµ
E/Jaemu>>: ì½”ë£¨í‹´ 11
E/Jaemu>>: ì½”ë£¨í‹´ 21
E/Jaemu>>: ì½”ë£¨í‹´ 12
E/Jaemu>>: ì½”ë£¨í‹´ 22
E/Jaemu>>: ì½”ë£¨í‹´ 13
E/Jaemu>>: ì½”ë£¨í‹´ 23
E/Jaemu>>: ì½”ë£¨í‹´ 14
E/Jaemu>>: ì½”ë£¨í‹´ 24
E/Jaemu>>: ì½”ë£¨í‹´ 15
E/Jaemu>>: ì½”ë£¨í‹´ 25        
```